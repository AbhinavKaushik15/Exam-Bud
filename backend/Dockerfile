FROM node:18-alpine
WORKDIR /usr/src/app


COPY package*.json ./
RUN npm install


COPY . .
RUN npx prisma generate

EXPOSE 4000


ENTRYPOINT ["sh","-c","\
  echo '‚è≥ Waiting for Postgres‚Ä¶'; \
  until nc -z db 5432; do sleep 1; done; \
  echo '‚úÖ Pushing schema‚Ä¶'; \
  npx prisma db push; \
  echo '‚úÖ Seeding‚Ä¶'; \
  node prisma/seed.js; \
  echo 'üöÄ Starting server'; \
  exec node index.js"]
